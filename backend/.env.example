# ===========================================
# Rate Limiter Backend Configuration
# ===========================================
# Copy this file to .env and fill in the values
# NEVER commit .env to version control

# ===========================================
# Server Configuration
# ===========================================

# Environment: development, staging, production
NODE_ENV=development

# Server port (default: 3000)
PORT=3000

# Server host (0.0.0.0 for Docker, localhost for local dev)
HOST=0.0.0.0

# ===========================================
# Redis Configuration
# ===========================================

# Redis host (localhost for local, redis for Docker)
REDIS_HOST=localhost

# Redis port (default: 6379)
REDIS_PORT=6379

# Redis password (leave empty for no auth)
REDIS_PASSWORD=

# Redis database number (0-15, default: 0)
REDIS_DB=0

# Enable TLS for Redis (set to 'true' in production with TLS-enabled Redis)
REDIS_TLS=false

# Failure mode when Redis is unavailable:
#   'open'   - Allow all requests (graceful degradation, recommended for development)
#   'closed' - Deny all requests (strict security, recommended for production)
REDIS_FAILURE_MODE=open

# Reconnection settings
REDIS_MAX_RETRIES=10
REDIS_RETRY_DELAY=200
REDIS_MAX_RETRY_DELAY=30000
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000

# ===========================================
# JWT Configuration (Week 2)
# ===========================================

# JWT private key path (for signing tokens)
# Generate keys: node scripts/generateKeys.js
JWT_PRIVATE_KEY_PATH=./keys/private.key

# JWT public key path (for verifying tokens)
JWT_PUBLIC_KEY_PATH=./keys/public.key

# Alternative: Embed keys directly (not recommended, use paths instead)
# JWT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
# JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----\n"

# JWT access token expiry (e.g., 1h, 15m, 30d)
JWT_ACCESS_TOKEN_EXPIRY=1h

# JWT refresh token expiry (e.g., 7d, 30d)
JWT_REFRESH_TOKEN_EXPIRY=7d

# JWT issuer (your app name)
JWT_ISSUER=ratetui

# JWT audience (your app URL or identifier)
JWT_AUDIENCE=ratetui-api

# ===========================================
# Password Hashing
# ===========================================

# Bcrypt rounds (higher = more secure but slower, recommended: 12)
BCRYPT_ROUNDS=12

# ===========================================
# Rate Limiting Defaults
# ===========================================

# Default rate limit (requests per window)
DEFAULT_RATE_LIMIT=100

# Default rate window (in seconds, 60 = 1 minute)
DEFAULT_RATE_WINDOW=60

# API endpoint rate limits (per IP)
API_RATE_LIMIT=200
API_RATE_WINDOW=60

# Authentication endpoint rate limits (per IP)
AUTH_RATE_LIMIT=10
AUTH_RATE_WINDOW=60
AUTH_BLOCK_DURATION=300

# Login rate limits (per IP) 
LOGIN_RATE_LIMIT=5
LOGIN_RATE_WINDOW=900
LOGIN_BLOCK_DURATION=900

# Admin rate limits (per user)
ADMIN_RATE_LIMIT=50
ADMIN_RATE_WINDOW=60

# Search endpoint rate limits (per IP)
SEARCH_RATE_LIMIT=30
SEARCH_RATE_WINDOW=60

# Expensive operations rate limits (per IP)
EXPENSIVE_RATE_LIMIT=10
EXPENSIVE_RATE_WINDOW=60

# File upload rate limits (per IP)
UPLOAD_RATE_LIMIT=5
UPLOAD_RATE_WINDOW=3600

# Password reset rate limits (per IP)
PASSWORD_RESET_RATE_LIMIT=3
PASSWORD_RESET_RATE_WINDOW=3600
PASSWORD_RESET_BLOCK_DURATION=3600

# Email sending rate limits (per IP)
EMAIL_RATE_LIMIT=10
EMAIL_RATE_WINDOW=3600

# API key-based rate limits
APIKEY_RATE_LIMIT=1000
APIKEY_RATE_WINDOW=3600

# ===========================================
# Admin Configuration (Week 2)
# ===========================================

# Admin email
ADMIN_EMAIL=admin@example.com

# Admin password hash
# Generate: node -e "console.log(require('bcryptjs').hashSync('your-password', 12))"
ADMIN_PASSWORD_HASH=$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/X4/9tL6fRZ6dN5yGy

# ===========================================
# CORS Configuration
# ===========================================

# Allowed origins (comma-separated, no spaces)
# Use * to allow all origins in development (not recommended for production)
CORS_ORIGINS=http://localhost:3001,http://localhost:5173

# ===========================================
# Logging Configuration
# ===========================================

# Log level: error, warn, info, http, debug
# Use 'debug' in development, 'info' in production
LOG_LEVEL=debug

# Log format: dev, combined, common, short, tiny
# dev - colored output for development
# combined - standard Apache combined log format for production
LOG_FORMAT=dev

# ===========================================
# Network Configuration
# ===========================================

# Trusted proxies for IP extraction (comma-separated)
# Options: loopback, linklocal, uniquelocal, or specific IPs (10.0.0.1,10.0.0.2)
# Important: Set correctly to extract real client IP behind load balancers/proxies
TRUST_PROXY=loopback
